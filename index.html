<!DOCTYPE html>
<html>
    <head>
        <title> 
            LEARN JAVASCRIPT
        </title>
    </head>

    <body>

        <input id="todo-title" type="text" />
        <input id="todo-date" type="date" />
    
        <button onclick="add()">PRESS ME</button>
        <div id='main'></div>

        <script>

            // Model Section
            let todo;

            //render();

            const saved = JSON.parse(localStorage.getItem('todo'));

            if(Array.isArray(saved)===true)
            {
                todo = saved;
            }

            else
                todo = [];


            render();
            
            //Create To Do
            function createtodo(textval,dateval)
            {
                const id = '' + new Date().getTime();

                todo.push({
                title: textval,
                due: dateval,
                id: id
                });

                savedtodo();
            }

            //Remove To Do
            function removetodo(idtodelete)
            {
                todo = todo.filter(function (b)
                {

                if( b.id === idtodelete)
                {
                    return false;
                }

                else
                {
                    return true;
                }

                });

                savedtodo();

            }

            function savedtodo()
            {
                localStorage.setItem('todo', JSON.stringify(todo));
            }

            //View Section
            function render()
            {

                document.getElementById('main').innerHTML="";

                todo.forEach(function(a)
                {
                    let dee= document.createElement('div');
                    dee.innerText=a.title + a.due;


                    const deletebutton = document.createElement('button');
                    deletebutton.innerText="Delete";
                    
                    deletebutton.onclick= deletetodo;
                    deletebutton.id= a.id;
                    deletebutton.style = 'margin-left: 12px;';
                    dee.appendChild(deletebutton);

                    
                    let todomain=document.getElementById('main');

                    todomain.appendChild(dee);

                });
            }


            //Control Section
            //Controller 1
            function add ()
            {

                let textbox = document.getElementById('todo-title');
                textval = textbox.value;

                const datepick = document.getElementById('todo-date');
                const dateval = datepick.value;

                createtodo(textval,dateval);

                render();
            }
            
            //Controller 2
            function deletetodo(event)
            {
                const eventvalue = event.target;
                const idtodelete = eventvalue.id;

                removetodo(idtodelete);

                render();

            }


        </script>
    </body>
</html>

